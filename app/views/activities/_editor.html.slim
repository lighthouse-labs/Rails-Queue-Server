- content_for :end_of_body do
  javascript:
    function initEditors() {

      var jsEditorOptions = {
        mode: "ace/mode/javascript",
        tabSize: 2,
        useSoftTabs: true
      }

      var instructionsEditor = ace.edit("instructions-editor");
      var notesEditor = ace.edit("notes-editor");

      instructionsEditor.setTheme("ace/theme/monokai");
      notesEditor.setTheme("ace/theme/monokai");
      

      instructionsEditor.getSession().setMode("ace/mode/markdown");
      notesEditor.getSession().setMode("ace/mode/markdown");

      instructionsEditor.setValue($('#instructions_content').text())
      notesEditor.setValue($('#notes_content').text())

      if ($('#activity-instructions').is(':disabled')) { 
        instructionsEditor.setReadOnly(true);
      }

      // evaluates code
      if($('#test-editor').length > 0) {
        var testEditor = ace.edit("test-editor");
        testEditor.setTheme("ace/theme/monokai");
        testEditor.session.setOptions(jsEditorOptions);
        testEditor.setValue($('#test_content').text())
      }

      if($('#initial-code-editor').length > 0) {
        var initialCodeEditor = ace.edit("initial-code-editor");
        initialCodeEditor.setTheme("ace/theme/monokai");
        initialCodeEditor.session.setOptions(jsEditorOptions);
        initialCodeEditor.setValue($('#initial_code_content').text())
      }

      $('#activity-form').submit(function(evt) {
        evt.preventDefault();
        
        $('#activity-instructions').val(instructionsEditor.getValue());
        $('#activity-notes').val(notesEditor.getValue());
        
        if($('#test-editor').length > 0) {
          $('#activity_activity_test_attributes_test').val(testEditor.getValue());
        }
        if($('#initial-code-editor').length > 0) {
          $('#activity_activity_test_attributes_initial_code').val(initialCodeEditor.getValue());
        }
        
        this.submit();
      });
    }
    $(initEditors); // regular document ready